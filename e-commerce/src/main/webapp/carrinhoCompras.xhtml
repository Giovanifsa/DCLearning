<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui" xmlns:b="http://bootsfaces.net/ui"
	xmlns:jsf="http://xmlns.jcp.org/jsf/composite">


<ui:composition template="gnr_template.xhtml">
	<ui:define name="body">
		<b:form id="carrinho">
			<h:outputLabel />

			<b:container id="container">
				<b:panel title="Carrinho de compras" look="primary"
					collapsible="false" small-screen="12" medium-screen="12"
					large-screen="12" showCollapseLink="false" tooltip-position="right"
					rendered="true" id="painel" icon="shopping-cart" icon-align="right"
					display="inline">

					<h:outputLabel id="t" />

					<b:dataTable value="#{carrinhoBean.produtosCarrinho()}"
						responsive="true" var="tabela" id="tabelaProdutos"
						fixedHeader="true" scroll-horizontally="true"
						mark-search-results="false" paginated="false" rendered="true"
						scroll-size="true" selection-info="false" info="false" col-xs="12"
						col-sm="12" col-md="12" col-lg="12" tiny-screen="half">

						<b:dataTableColumn label="Produto" style="text-align:center">
							#{tabela.produto.nome}
						</b:dataTableColumn>

						<b:dataTableColumn label="Descrição" style="text-align:center">
							#{tabela.produto.descricao}
						</b:dataTableColumn>

						<b:dataTableColumn orderable="false" label="Imagem"
							style="text-align:center">
							<img
								src="#{request.contextPath}/#{tabela.produto.imagemPotencial.nomeDiretorio}/#{tabela.produto.imagemPotencial.nomeArquivo}"
								width="50px" align="middle" />
						</b:dataTableColumn>
						
						<b:column width="9%" style="text-align:center" label="Preço">
							<br />
							<h:outputLabel value="R$ #{carrinhoBean.produtoAtualizado}" style="text-align:center" id="idPreco" />
						</b:column>
						
						<b:column label="Quantidade" orderable="false" width="15%" 
							style="text-align:center" >
							<form>
								<b:touchSpin value="#{tabela.quantidade}" update="idPreco"
									large-screen="11" min="#{tabela.produto.quantidade}" step="1" ajax="true"
									size="1000" vertical-buttons="true" small-screen="half"
									col-xs="12" col-md="12" col-sm="12" col-lg="12"
									field-size="large"/>
							</form>
						</b:column>
	
						<b:dataTableColumn orderable="false" width="9%" label="Remover"
							style="text-align:center">
							<br />
							<b:commandButton
								action="#{carrinhoBean.removerProduto(tabela.produto)}"
								process="@form carrinho:container:painel:tabelaProdutos"
								class="btn btn-danger" title="Remover produto" ajax="true"
								update="@form carrinho:container:painel:tabelaProdutos"
								col-xs="12" col-sm="12" col-md="12" colLg="40">

								<b:icon value="trash" col-xs="12" col-sm="2" />
								<br />
							</b:commandButton>
						</b:dataTableColumn>
					</b:dataTable>
					<b:form>
						<b:panelGrid col-spans="6,6" columns="12" rendered="true"
							col-xs="12" col-sm="12" col-md="12" col-lg="12"
							small-screen="three-fourths" medium-screen="three-fourths"
							large-screen="three-fourths">
							<b:commandButton value="Voltar ao site" rendered="true"
								title="Voltar ao site" small-screen="half" ajax="true"
								medium-screen="three-fourths" large-screen="three-fourths"
								col-xs="12" col-ms="6" col-md="4" col-lg="9" offset-md="1"
								offset-lg="2" class="btn btn-primary" look="primary"
								action="#{carrinhoBean.voltarParaLoja()}" process="@this" />

							<h:form id="idFinal">
									<b:commandButton value="Finalizar compra" action="#{carrinhoBean.finalizarCompra()}"
										look="success" onclick="$('.compraFinalizada').modal()"
										size="md" ajax="false" auto-update="false"
										class="btn btn-success" small-screen="half"
										medium-screen="one-fourth" process="@this"
										large-screen="one-third" col-xs="12" col-ms="6" col-md="4"
										col-lg="9" offset-md="2" offset-lg="2" autoUpdate="false"
										/>
								<b:modal id="amodal2" title="Compra finalizada com sucesso!"
									styleClass="compraFinalizada" closable="false"
									close-on-escape="true" backdrop="false">
									<p>Valor total: R$ #{carrinhoBean.calcularPrecoFinal()}</p>

									<f:facet name="footer">
										<b:commandButton value="Ok" look="info" dismiss="modal"
											dir="auto" action="login?faces-redirect=true" />
									</f:facet>
 								</b:modal> 
							</h:form>

						</b:panelGrid>
					</b:form>
				</b:panel>

			</b:container>

		</b:form>
	</ui:define>
</ui:composition>
</html>
